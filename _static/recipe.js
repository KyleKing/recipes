(function(){"use strict";var b=800,C=100,j=5e3,s=[],c=null,l=null,i=0;function d(){return"recipe-progress-"+window.location.pathname}function e(){try{var e=localStorage.getItem(d());return e?JSON.parse(e):{}}catch{return{}}}function o(e){try{localStorage.setItem(d(),JSON.stringify(e))}catch{}}function v(){var i=e(),a=document.querySelectorAll(".task-list"),s=0;a.forEach(function(a){var r=a.querySelectorAll(":scope > li");r.forEach(function(a){var c,r=a.querySelector(":scope > input[type='checkbox']");if(!r)return;c="ingredient-"+s,s++,r.dataset.storageKey=c,i[c]&&(r.checked=!0,a.classList.add("completed")),a.style.cursor="pointer",a.addEventListener("click",function(s){if(s.target.tagName==="A")return;if(s.target.closest("li")!==a)return;r.checked=!r.checked,a.classList.toggle("completed",r.checked);var l,i=e();i[c]=r.checked,l=a.querySelectorAll("ul.task-list input[type='checkbox']"),l.forEach(function(e){e.checked=r.checked;var t,n=e.closest("li");n&&n.classList.toggle("completed",r.checked),t=e.dataset.storageKey,t&&(i[t]=r.checked)}),o(i),t(),n()})})})}function m(){var a=e(),r=document.querySelectorAll("section"),i=0,s=new Map;r.forEach(function(r){var l=r.querySelectorAll("ol");l.forEach(function(e){e.classList.add("recipe-steps");var t=e.querySelectorAll(":scope > li");t.forEach(function(e){var t="step-"+i;i++,s.set(e,t),a[t]&&e.classList.add("completed")})});function c(i){i.classList.toggle("completed");var r=s.get(i),a=e();a[r]=i.classList.contains("completed"),o(a),t(),n()}r.addEventListener("click",function(e){for(var t,s,i,o=r.querySelectorAll("ol.recipe-steps > li"),n=0;n<o.length;n++)if(s=o[n],t=s.getBoundingClientRect(),i=e.clientX-t.left,e.clientY>=t.top&&e.clientY<=t.bottom&&i<30){c(s);break}}),r.addEventListener("dblclick",function(e){var t=e.target.closest("ol.recipe-steps > li");t&&s.has(t)&&c(t)})})}function u(){var e=document.getElementById("back-btn");if(!e)return;window.addEventListener("scroll",function(){clearTimeout(c),c=setTimeout(function(){var e=window.scrollY,t=Math.abs(e-i);t>=C&&(s.push(i),s.length>20&&s.shift(),i=e,a())},b)})}function a(){var e=document.getElementById("back-btn");if(!e||s.length===0)return;e.style.display="inline-block",e.classList.remove("fading"),clearTimeout(l),l=setTimeout(function(){e.classList.add("fading")},j)}function f(){if(s.length===0)return;var e,t=s.pop();window.scrollTo({top:t,behavior:"smooth"}),e=document.getElementById("back-btn"),e&&s.length===0?e.style.display="none":a()}function p(e){var t=e.querySelectorAll("input[type='checkbox']"),n=e.querySelectorAll("ol.recipe-steps li");return t.length>0||n.length>0}function g(){var s=e(),i=document.querySelectorAll("section");i.forEach(function(i){var a,c,l=i.querySelector("h2"),d=i.querySelector("h3"),r=l||d;if(!r)return;if(!p(i))return;c=i.id||r.textContent.trim().toLowerCase().replace(/\s+/g,"-"),i.classList.add("collapsible"),a=document.createElement("span"),a.className="collapse-toggle",a.textContent="-",a.setAttribute("aria-label","Toggle section"),r.appendChild(a),s["collapsed-"+c]&&(i.classList.add("collapsed"),a.textContent="+"),a.addEventListener("click",function(s){s.stopPropagation();var r,l,d=!i.classList.contains("collapsed");d?(r=i.querySelectorAll("li.completed"),r.forEach(function(e){e.classList.add("hiding")}),setTimeout(function(){i.classList.add("collapsed"),a.textContent="+",r.forEach(function(e){e.classList.remove("hiding")}),t()},400)):(i.classList.remove("collapsed"),a.textContent="-",t()),l=e(),l["collapsed-"+c]=d,o(l),n()})}),t()}function t(){var e=document.querySelectorAll("section.collapsible");e.forEach(function(e){var n,s,o,i,a,r,c,l,d,t=e.querySelector("h2, h3");if(!t)return;if(s=t.querySelector(".section-summary"),s&&s.remove(),!e.classList.contains("collapsed"))return;if(o=e.querySelectorAll("input[type='checkbox']"),i=e.querySelectorAll("ol.recipe-steps li"),a=o.length+i.length,a===0)return;c=Array.from(o).filter(function(e){return e.checked}).length,l=Array.from(i).filter(function(e){return e.classList.contains("completed")}).length,d=c+l,n=document.createElement("span"),n.className="section-summary",n.textContent=" ("+d+"/"+a+")",r=t.querySelector(".collapse-toggle"),r?t.insertBefore(n,r):t.appendChild(n)})}function h(){var e=document.querySelectorAll("section[id]");e.forEach(function(e){var t,n=e.querySelector("h2, h3");if(!n)return;t=document.createElement("a"),t.className="header-anchor",t.href="#"+e.id,t.textContent="#",t.setAttribute("aria-label","Link to this section"),n.appendChild(t),t.addEventListener("click",function(t){t.preventDefault(),history.pushState(null,"","#"+e.id),e.scrollIntoView({behavior:"smooth"})})})}function n(){var e=document.getElementById("toggle-collapse-btn"),t=document.getElementById("reset-btn"),n=document.querySelectorAll("section.collapsible"),s=document.querySelectorAll("section.collapsed"),o=s.length===n.length,i=document.querySelectorAll("input[type='checkbox']:checked").length>0,a=document.querySelectorAll("ol.recipe-steps li.completed").length>0;e&&n.length>0&&(e.style.display="inline-block",o?(e.textContent="Expand All",e.title="Expand all collapsed sections"):(e.textContent="Collapse All",e.title="Collapse all sections")),t&&(t.style.display=i||a?"inline-block":"none")}function y(){document.querySelectorAll("section.collapsed").forEach(function(e){e.classList.remove("collapsed");var t=e.querySelector(".collapse-toggle");t&&(t.textContent="-")});var s=e();Object.keys(s).forEach(function(e){e.startsWith("collapsed-")&&delete s[e]}),o(s),t(),n()}function _(){var a=document.querySelectorAll("section.collapsible:not(.collapsed)"),s=[],i=e();a.forEach(function(e){e.classList.add("collapsed");var n,o,t=e.querySelector(".collapse-toggle");t&&(t.textContent="+"),n=e.id||e.querySelector("h2, h3").textContent.trim().toLowerCase().replace(/\s+/g,"-"),i["collapsed-"+n]=!0,o=e.querySelectorAll("li.completed"),o.forEach(function(e){e.classList.add("hiding"),s.push(e)})}),o(i),setTimeout(function(){s.forEach(function(e){e.classList.remove("hiding")}),t(),n()},400)}function w(){var s=e();document.querySelectorAll("input[type='checkbox']").forEach(function(e){e.checked=!1;var t=e.closest("li");t&&t.classList.remove("completed")}),document.querySelectorAll("ol.recipe-steps li.completed").forEach(function(e){e.classList.remove("completed")}),Object.keys(s).forEach(function(e){(e.startsWith("ingredient-")||e.startsWith("step-"))&&delete s[e]}),o(s),t(),n()}function O(){var t,e=document.querySelectorAll("section.collapsible"),n=document.querySelectorAll("section.collapsed");if(e.length===0)return;t=n.length===e.length,t?y():_()}function x(){var s,t=document.getElementById("recipe-toolbar"),n=document.getElementById("toolbar-toggle");if(!t||!n)return;s=e(),s["toolbar-hidden"]&&t.classList.add("hidden"),n.addEventListener("click",function(){t.classList.toggle("hidden");var n=e();n["toolbar-hidden"]=t.classList.contains("hidden"),o(n)})}function r(){if(document.body.classList.contains("trmnl-mode"))return;v(),m(),u(),g(),h(),x();var e,t,s=document.getElementById("back-btn");s&&s.addEventListener("click",f),e=document.getElementById("toggle-collapse-btn"),e&&e.addEventListener("click",O),t=document.getElementById("reset-btn"),t&&t.addEventListener("click",w),n(),i=window.scrollY}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r()})()