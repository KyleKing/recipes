/* Initially adapted from Copyright (C) 2021  Guilherme Pangnotta code License:
 https://github.com/setetres/evenbettermotherfuckingwebsite/blob/master/LICENSE
 and http://bettermotherfuckingwebsite.com
 and https://thebestmotherfucking.website */

/* Ordered and follows best practices from:
 https://github.com/frontaid/natural-selection/blob/b2007b4e1b9391a3a2b18892e96bebf238048fa0/boilerplate.css */

/* Fonts and styles based on guidance in:
 https://practicaltypography.com
 https://practicaltypography.com/free-fonts.html
 https://practicaltypography.com/system-fonts.html
 and implementation; https://github.com/arp242/hello-css/blob/59ff066baca3d7c00dd9e5e67226bb360d3f64a2/base.css */

/* Consider tips on selection:
 https://css-tricks.com/where-has-a-cool-specificity-trick-too
 https://css-tricks.com/strategies-keeping-css-specificity-low */

/* Minimal normalize; adapted from:
 https://github.com/sindresorhus/modern-normalize */

html,
body {
    margin: 0;
}

/* Root */

:root {
    --color-back: #eaeaea;
    --color-text: #454545;
    --color-link: #07a;
    --color-link-visited: #07a;
}

/* Minimum set of used fonts from Atkinson Hyperlegible fonts
   https://www.brailleinstitute.org/freefont */
@font-face {
    font-family: "Atkinson Hyperlegible Mono";
    src: url("./resources/AtkinsonHyperlegibleMono-Regular.woff2")
        format("woff2");
}
@font-face {
    font-family: "Atkinson Hyperlegible Next";
    src: url("./resources/AtkinsonHyperlegibleNext-BoldItalic.woff2")
        format("woff2");
    font-weight: bold;
    font-style: italic;
}
@font-face {
    font-family: "Atkinson Hyperlegible Next";
    src: url("./resources/AtkinsonHyperlegibleNext-Bold.woff2") format("woff2");
    font-weight: bold;
}
@font-face {
    font-family: "Atkinson Hyperlegible Next";
    src: url("./resources/AtkinsonHyperlegibleNext-RegularItalic.woff2")
        format("woff2");
    font-style: italic;
}
@font-face {
    font-family: "Atkinson Hyperlegible Next";
    src: url("./resources/AtkinsonHyperlegibleNext-Regular.woff2")
        format("woff2");
}

body {
    background: var(--color-back);
    color: var(--color-text);
    font-family: "Atkinson Hyperlegible Next"; /* Palatino, serif; */
    font-size: 18px;
    line-height: 1.45;
    margin-bottom: 40%;
}

/* Content sectioning */

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: "Atkinson Hyperlegible Next"; /* Optima, sans-serif; */
    line-height: 0.9;
}

nav {
    padding: 10px 0;
}

/* Text block content */

ol:nth-child(odd) {
    list-style: lower-alpha;
}

ul.task-list {
    list-style: disc;
    padding-left: 20px;
}

ul.task-list input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

ul.flat-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
ul.flat-list li {
    position: relative;
    display: inline-block;
    margin-right: 20px;
}

pre {
    background: rgba(180, 180, 180, 0.1);
    font-family: "Atkinson Hyperlegible Mono"; /* monospace; */
    padding: 5px;
}
pre code {
    max-width: 100%;
    white-space: pre-wrap;
}

/* Inline text semantics */

a {
    color: var(--color-link);
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}
a:visited {
    color: var(--color-link-visited);
}

/* Embedded content */

img.fullsize {
    max-height: 300px;
    max-width: 100%;
}

.wrapped-images-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.wrapped-images-container figcaption {
    margin-top: 5px;
}

/* `square-img` from: https://stackoverflow.com/a/55966300/3219667 */

.square-img-container {
    position: relative;
}

.square-img-container::after {
    content: "";
    display: block;
    padding-bottom: 100%;
}

img.square-img {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: #959595 0.5px solid;
}

/* Media queries */

nav div,
main {
    margin: auto;
}
@media (min-width: 760px) {
    nav div,
    main {
        max-width: 650px;
    }
}
@media (max-width: 759px) {
    nav div,
    main {
        max-width: 85%;
    }
}

/* E-ink Display Optimizations for TRMNL (800x480 landscape) */
/* Trigger with ?trmnl=1 query parameter or use .trmnl-mode class */

body.trmnl-mode {
    font-size: 14px;
    line-height: 1.25;
    margin: 0;
    padding: 8px;
    background: white;
    color: black;
    margin-bottom: 0;
}

/* Hide navigation and images for cleaner e-ink display */
body.trmnl-mode nav,
body.trmnl-mode img,
body.trmnl-mode img.fullsize,
body.trmnl-mode .wrapped-images-container,
body.trmnl-mode .square-img-container {
    display: none;
}

/* Compact headings for limited vertical space */
body.trmnl-mode h1 {
    font-size: 22px;
    margin: 4px 0;
    line-height: 1.1;
}

body.trmnl-mode h2 {
    font-size: 17px;
    margin: 6px 0 3px 0;
    line-height: 1.1;
}

body.trmnl-mode h3 {
    font-size: 15px;
    margin: 5px 0 2px 0;
    line-height: 1.1;
}

body.trmnl-mode h4,
body.trmnl-mode h5,
body.trmnl-mode h6 {
    font-size: 14px;
    margin: 4px 0 2px 0;
}

/* Compact lists for ingredient and recipe steps */
body.trmnl-mode ul,
body.trmnl-mode ol {
    margin: 3px 0;
    padding-left: 18px;
}

body.trmnl-mode li {
    margin: 1px 0;
    line-height: 1.2;
}

/* Hide checkboxes and show as regular list */
body.trmnl-mode .task-list input[type="checkbox"] {
    display: none;
}

body.trmnl-mode .task-list {
    list-style: disc;
    padding-left: 15px;
}

/* Ensure main content uses full width */
body.trmnl-mode main {
    max-width: 100%;
    margin: 0;
    padding: 0;
}

/* Compact sections */
body.trmnl-mode section {
    margin-bottom: 8px;
}

/* Reduce paragraph spacing */
body.trmnl-mode p {
    margin: 3px 0;
}

/* Make links readable on e-ink (no colors, just underline) */
body.trmnl-mode a {
    color: black;
    text-decoration: underline;
}

body.trmnl-mode a:visited {
    color: black;
}

body.trmnl-mode a:hover {
    text-decoration: underline;
}

/* Compact code blocks if present */
body.trmnl-mode pre {
    font-size: 12px;
    padding: 3px;
    margin: 3px 0;
}

body.trmnl-mode code {
    font-size: 13px;
}

/* Hide navigation flat list */
body.trmnl-mode ul.flat-list {
    display: none;
}

/* Optimize nested lists in recipes */
body.trmnl-mode ol ol,
body.trmnl-mode ul ul {
    margin: 2px 0;
    padding-left: 15px;
}

/* Ensure proper rendering on grayscale e-ink */
body.trmnl-mode {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Tab UI Styles */

.tabs-container {
    margin-top: 20px;
}

.tab-nav {
    display: flex;
    gap: 15px;
    border-bottom: 2px solid #ccc;
    margin-bottom: 20px;
    padding-bottom: 10px;
}

.tab-nav a {
    padding: 8px 16px;
    text-decoration: none;
    border: 1px solid transparent;
    border-radius: 4px 4px 0 0;
    transition: all 0.2s ease;
}

.tab-nav a:hover {
    background: rgba(180, 180, 180, 0.1);
    border-color: #ccc;
}

.tab-content {
    display: none;
}

.tab-content:target {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.tab-content h2 {
    margin-top: 0;
}

.tab-content h3 {
    margin-top: 30px;
    margin-bottom: 10px;
}

/* Related Recipes Match Details */

.match-details,
.no-match-details {
    margin-top: 8px;
    font-size: 14px;
}

.match-details summary,
.no-match-details summary {
    cursor: pointer;
    color: var(--color-link);
    font-size: 13px;
    padding: 4px 0;
    user-select: none;
}

.match-details summary:hover,
.no-match-details summary:hover {
    text-decoration: underline;
}

.match-info,
.no-match-info {
    margin-top: 8px;
    padding: 8px;
    background: rgba(180, 180, 180, 0.1);
    border-left: 3px solid var(--color-link);
    font-size: 13px;
    line-height: 1.4;
}

.match-info p,
.no-match-info p {
    margin: 6px 0;
}

.match-info strong,
.no-match-info strong {
    font-weight: bold;
}

.score-breakdown {
    color: #666;
    margin-top: 8px !important;
}

.ingredient-tokens {
    font-family: "Atkinson Hyperlegible Mono";
    font-size: 12px;
    line-height: 1.5;
}

/* Hide details for e-ink display */
body.trmnl-mode .match-details,
body.trmnl-mode .no-match-details {
    display: none;
}

/* Recipe Navigation - Floating Toolbar */

.recipe-toolbar {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 100;
}

.toolbar-btn {
    border: 2px solid var(--color-text);
    background: var(--color-back);
    color: var(--color-text);
    padding: 8px 12px;
    font-size: 14px;
    font-family: inherit;
    cursor: pointer;
    transition: opacity 1s ease;
}

.toolbar-btn:hover {
    background: rgba(180, 180, 180, 0.3);
}

.toolbar-btn.fading {
    opacity: 0;
    pointer-events: none;
}

/* Recipe Steps - Click on number to toggle */

.recipe-steps li::marker {
    cursor: pointer;
}

/* Completed Items */

.recipe-steps li.completed,
.task-list li.completed {
    opacity: 0.6;
    text-decoration: line-through;
    transition: opacity 0.3s ease;
}

.task-list li.completed {
    list-style-type: "âœ“ ";
}

/* Hiding animation for collapse */

li.hiding {
    animation: fadeOutHide 0.4s ease forwards;
}

@keyframes fadeOutHide {
    0% {
        opacity: 0.6;
        max-height: 100px;
    }
    70% {
        opacity: 0;
        max-height: 100px;
    }
    100% {
        opacity: 0;
        max-height: 0;
        padding: 0;
        margin: 0;
        overflow: hidden;
    }
}

/* Section Folding */

section.collapsible.collapsed > *:not(h2):not(h3):not(ul):not(ol) {
    display: none;
}

section.collapsible.collapsed li.completed {
    display: none;
}

.collapse-toggle {
    margin-left: 0.5em;
    font-family: monospace;
    font-weight: normal;
    cursor: pointer;
    color: var(--color-link);
    user-select: none;
}

.collapse-toggle:hover {
    text-decoration: underline;
}

.section-summary {
    font-size: 0.7em;
    font-weight: normal;
    color: #666;
    font-style: italic;
}

/* Header Anchors */

.header-anchor {
    margin-left: 0.3em;
    opacity: 0;
    color: var(--color-link);
    text-decoration: none;
    font-weight: normal;
    transition: opacity 0.2s ease;
}

h2:hover .header-anchor,
h3:hover .header-anchor,
.header-anchor:focus {
    opacity: 0.5;
}

.header-anchor:hover {
    opacity: 1;
    text-decoration: underline;
}

/* E-ink Mode - Hide Interactive Elements */

body.trmnl-mode .recipe-toolbar,
body.trmnl-mode .section-summary,
body.trmnl-mode .collapse-toggle,
body.trmnl-mode .header-anchor {
    display: none;
}

body.trmnl-mode section.collapsible.collapsed > *,
body.trmnl-mode section.collapsible.collapsed li.completed {
    display: block;
}

/* Mobile - Larger Touch Targets */

@media (max-width: 759px) {
    .toolbar-btn {
        padding: 10px 14px;
        font-size: 16px;
    }
}
